---
description: Document v 1.0.0
---

# Report

Here you can see the [Terms of contract](../../../../report.md) of this Penetration test.

## Executive Summary

Pentester Corp evaluated Demo Corp's interal security posture through penetration testing from March 11th, 2024 to March 15th, 2024. The following sections provide a high-level overview of vulnerabilities discovered, successfull and unsuccessful attempts, and strengths and weaknesses.

### Scoping and Time Limitations

Scoping during the engagement did not permit denial of service or social engineering across all testing components.

Time limitations were in place for testing. Internal network penetration testing was permitted for 5 business days.

### Testing Summary

The client wants to release his virtual environment to production in seven days. The client doesen't give any information and wants Pentester Corp to act like a malicious actor. In this case this is a black box penetration test.

The goal is to read two files mentioned as follow (in this case flags) with information as proof of exploitation:

* User.txt
* Root.txt

Additionally the client has provided the following scope allowances:

* Any tools or techniques are permitted in this engagement, however we ask that you attempt manual exploitation first
* Locate and note all vulnerabilities found
* Submit the flags discovered to the dashboard
* Only the IP address assigned to your machine is in scope
* Find and report ALL vulnerabilities (yes, there is more than one path to root)

The network assessment evaluated Demo Corp's internal network security posture. From an internal perspective, the Pentester Corp performed vulnerability scanning against all IPs.

Pentester Corp discovered <mark style="color:blue;">**8 open ports**</mark>. Two of them are a webserver (IIS) and two are for the smb server. The ports are not common.

With directory enumerating tools Pentester Corp has found a directory called <mark style="color:blue;">**nt4wrksv**</mark> on the webserver on port <mark style="color:blue;">**49663**</mark>. Further enumeration of the Samba service shows the content of a <mark style="color:blue;">**passwords.txt**</mark> file. There were base64 encoded credentials stored strings. Pentester Corp decoded the credentials and could login to the samba share with the credentials from a user (bob) and upload a reverse shell.

The open accessible passwords.txt file on the Samba share let Pentester Corp login to the local account of Bob. Pentester Corp then could read the content of the <mark style="color:red;">**User.txt**</mark> file found on the users desktop.

**Evidence**

THM{fdk4<mark style="color:red;">\[REDACTED]</mark>tf45}

The uploaded reverse shell let Pentester Corp connect to the server. Pentester Corp then could read the content of the <mark style="color:red;">**Root.txt**</mark> file found on the administrator's desktop.

Evidence

THM{1fk5<mark style="color:red;">\[REDACTED]</mark>45pv}

The remainder of the findings were <mark style="color:red;">critical</mark>, <mark style="color:orange;">moderate</mark>, or <mark style="color:blue;">informational</mark>. For further information on findings, please review the [Technical Findings](report.md#technical-findings) section.

### Tester Notes and Recommendations

During testing, three constants stood out: a weak password policy, an open accessible samba share and a user with too much privileges.

The weak password policy led to the initial compromise of an account and is usually one of the first footholds an attacker attempts to use in a network. The presence of a weak password policy is backed up by the evidence of the content of the file (passwords.txt) on the samba share encoded in base64.

We recommended that Demo Corp re-evaluates their current password policy and considers a policy of not storing any passwords in a file especially if it's open accessible. We also recommend that Demo Corp needs a password manager to store their passwords secretly. Finally, a Privilege Access Management solution should be considered.

### Key Strengths and Weaknesses

The following identifies the key strengths identified during the assessment:

1. Passwords are not found in a common passwordlist like rockyou.txt

The following identifies the key weaknesses identified during the assessment:

1. Password policy found to be insufficient
2. Samba share was openly accessible (over webserver)
3. Samba share was not password protected
4. SeImpersonatePrivilege was enabled
5. The user Bob had too much privileges enabled

## Vulnerability Summary & Report Card

### Discovered weaknesses

* CWE-250: Execution with Unnecessary Privileges
* CWE-257: Storing Passwords in a Recoverable Format
* CWE-269: Improper Privilege Management
* CWE-521: Weak Password Requirements
* CWE-862: Missing Authorization

The following tables illustrate the vulnerabilities found by impact and recommended remediations:

### External Penetration Test Findings

| 1                                        | 0                                       | 1                                           | 0                                     | 0                                              |
| ---------------------------------------- | --------------------------------------- | ------------------------------------------- | ------------------------------------- | ---------------------------------------------- |
| <mark style="color:red;">Critical</mark> | <mark style="color:orange;">High</mark> | <mark style="color:yellow;">Moderate</mark> | <mark style="color:green;">Low</mark> | <mark style="color:blue;">Informational</mark> |

<table><thead><tr><th width="310">Finding</th><th width="105">Severity</th><th>Recommendation</th></tr></thead><tbody><tr><td>EPT-001: Unauthenticated SMB Share Access</td><td><mark style="color:yellow;">Moderate</mark></td><td>Set a password for the SMB share.</td></tr><tr><td>EPT-002: Insufficient Password policy</td><td><mark style="color:red;">Critical</mark></td><td>Use a password manager to save strong and unique passwords and not in files.</td></tr></tbody></table>

### Internal Penetration Test Findings

| 1                                        | 0                                       | 0                                           | 0                                     | 1                                              |
| ---------------------------------------- | --------------------------------------- | ------------------------------------------- | ------------------------------------- | ---------------------------------------------- |
| <mark style="color:red;">Critical</mark> | <mark style="color:orange;">High</mark> | <mark style="color:yellow;">Moderate</mark> | <mark style="color:green;">Low</mark> | <mark style="color:blue;">Informational</mark> |

<table><thead><tr><th width="296">Finding</th><th width="134">Severity</th><th>Recommendation</th></tr></thead><tbody><tr><td>IPT-001: Insufficient Privileged User Management</td><td><mark style="color:red;">Critical</mark></td><td>Limit local admin users via least privilege.</td></tr><tr><td>IPT-002: Steps to NT Authority\system</td><td><mark style="color:blue;">Informational</mark></td><td>Review action and remediation steps.</td></tr></tbody></table>

## Technical Findings

### External Penetration Test Findings

Finding EPT-001: Missing Authorization (<mark style="color:yellow;">Moderate</mark>)

<table data-header-hidden><thead><tr><th width="137"></th><th></th></tr></thead><tbody><tr><td>Description:</td><td>Demo Corp has a Samba share on the server with unauthenticated access.</td></tr><tr><td>Risk:</td><td>Likelihood: Moderate - Adversaries will discover these shares with low-noise, basic reconnaissance techniques.<br><br>Impact: Moderate - An attacker can upload a malicious file (a reverse shell) to gain a foothold on the server.</td></tr><tr><td>System:</td><td>Samba share on 10.x.x.x</td></tr><tr><td>Tools Used:</td><td>smbclient</td></tr><tr><td>References:</td><td><a href="https://cwe.mitre.org/data/definitions/862.html">CWE-862: Missing Authorization</a></td></tr></tbody></table>

**Evidence**

<figure><img src="../../../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

**Remediation**

Disable SMB share or require authentication. Enabling authentication on the share will protect the confidentiality of the stored information. Exporting authentication logs to a SIEM solution will give incident response teams insights to brute force login attempts.



Finding EPT-002: Insufficient Password policy (<mark style="color:red;">Critical</mark>)

<table data-header-hidden><thead><tr><th width="141"></th><th></th></tr></thead><tbody><tr><td>Description:</td><td>Demo Corp has passwords stored in a Recoverable Format.</td></tr><tr><td>Risk:</td><td>Likelihood: High - The passwords can be easily recover within seconds.<br><br>Impact: Very High - When recovered an attacker can login to a user account on the system.</td></tr><tr><td>System:</td><td>All</td></tr><tr><td>Tools Used:</td><td>Manual decoded with base64</td></tr><tr><td>References:</td><td><a href="https://cwe.mitre.org/data/definitions/521.html">CWE-257: Storing Passwords in a Recoverable Format</a><br><a href="https://cwe.mitre.org/data/definitions/521.html">CWE-521: Weak Password Requirements</a></td></tr></tbody></table>

**Evidence**

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<table><thead><tr><th width="431">Base64 encoded</th><th>Base64 decoded</th></tr></thead><tbody><tr><td>Qm9iIC0gIVBAJCRXMHJEITEyMw==</td><td><img src="../../../../.gitbook/assets/image (55).png" alt=""></td></tr><tr><td>QmlsbCAtIEp1dzRubmFNNG40MjA2OTY5NjkhJCQk</td><td><img src="../../../../.gitbook/assets/image (56).png" alt="" data-size="original"></td></tr></tbody></table>

**Remediation**

Never store passwords in a file. Save passwords instead in a password manager like [1Password](https://1password.com/), [keepass](https://keepass.info/), [C2 Password](https://c2.synology.com/) or an other. Overthinking the Password policy can protect an attacker from abusing the system. Even if the passwords are stored in a password manager and the passwords cannot be found in a common password list such as rockyou.txt it is still possible to gain access to the system using brute force methods. Password manager generate passwords in various length and characters - and you dont have to remember them.



### Internal Penetration Test Findings

Finding IPT-001: Insufficient Privileged User Management (<mark style="color:red;">Critical</mark>)

<table data-header-hidden><thead><tr><th width="137"></th><th></th></tr></thead><tbody><tr><td>Description:</td><td>The user Bob on the system has higher privileges as needed. This includes that SeImpersonatePrivilege is enabled and an attacker can abuse the user account with a malicious file to escalate privileges to Administrator and hijack the system.</td></tr><tr><td>Risk:</td><td>Likelihood: High - The malicious file can be uploaded and executed.<br><br>Impact: Very High - Hijacking of the system.</td></tr><tr><td>System:</td><td>All</td></tr><tr><td>Tools Used:</td><td>PrintSpoofer64.exe</td></tr><tr><td>References:</td><td><a href="https://cwe.mitre.org/data/definitions/250.html">CWE-250: Execution with Unnecessary Privileges</a><br><a href="https://cwe.mitre.org/data/definitions/269.html">CWE-269: Improper Privilege Management</a></td></tr></tbody></table>

**Evidence**

<figure><img src="../../../../.gitbook/assets/image (5) (1).png" alt=""><figcaption></figcaption></figure>

**Remediation**

Limit local admin users via least privilege. Disable all privileges on all users.



Finding IPT-002: Steps to NT Authority\system (<mark style="color:blue;">Informational</mark>)

The steps below describe how the penetration tester obtained nt authority\system access. Each step also provides remediation recommendations to help mitigate risk.

<table><thead><tr><th width="82">Step</th><th>Action</th><th>Remediation</th></tr></thead><tbody><tr><td>1</td><td>Login with found credentials on unauthenticated Samba share.</td><td>Secure Samba share with a strong password.</td></tr><tr><td>2</td><td>Uploaded PrintSpooferx64.exe as local administrator</td><td>Limit local administrator privileges and enforce least privilege.</td></tr><tr><td>3</td><td>Run PrintSpooferx64.exe</td><td>Disable SeImpersonatePrivilege on all Users</td></tr></tbody></table>

**Remediation**

Review action and remediation steps.

### Cleanup

As in the contract with the client discussed Pentester Corp remove all uploaded files and put back the backed up files to restore to the beginning.

Pentester Corp just uploaded the following files and did not manipulate existing files:

* PrintSpoofer64.exe
* shell.aspx

<figure><img src="../../../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption><p>Proof the files were removed</p></figcaption></figure>

## Additional reporting

Here you can see the [Additional Scans and Reports](../../../../additional-scans-and-reports.md) of this Penetration test.
